# Rules
# This file contains the actual rule definitions
# Others can pull/extend this file

rules:
  # OWASP rules
  - organization: OWASP
    code: "001"
    rule_class: IOH
    name: LLM output executed without sanitization
    description: |
      Detects cases where LLM-generated content is passed directly to exec/eval/shell without validation.
      Patterns: exec(llm_output), os.system(llm_output), subprocess.run(llm_output) with no sanitization.
    severity: error
    enabled: true
    source:
      name: 2025 Top 10 Risk & Mitigations for LLMs and Gen AI Apps
      link: https://genai.owasp.org/llm-top-10/

  - organization: OWASP
    code: "002"
    rule_class: IOH
    name: LLM output rendered to browser without encoding
    description: |
      Identifies when LLM output is inserted into web/JS/Markdown contexts without proper encoding/escaping.
      Patterns: innerHTML = llm_output, render_template(content=llm_output) with no escape.
    severity: warning
    enabled: true
    source:
      name: 2025 Top 10 Risk & Mitigations for LLMs and Gen AI Apps
      link: https://genai.owasp.org/llm-top-10/

  - organization: OWASP
    code: "003"
    rule_class: IOH
    name: LLM output used in DB/file path without parameterization
    description: |
      Checks when LLM output is used directly to build SQL queries, file paths, or commands without safeguards.
      Patterns: query = f"…{llm_output}…", open(f"/tmp/{llm_output}"), db.execute(llm_output) without parameterization.
    severity: error
    enabled: true
    source:
      name: 2025 Top 10 Risk & Mitigations for LLMs and Gen AI Apps
      link: https://genai.owasp.org/llm-top-10/

  # NEOps rules
  - organization: NEOps
    code: "001"
    rule_class: MP
    name: Model provider is listed as Worrying
    description: |
      Checks if the code or configuration uses a model provider flagged as Worrying in the provider list.
      Model provider invocation (e.g., model_provider = "DeepSeek") and that provider is in the "Worrying" list.
    severity: warning
    enabled: true
    source:
      name: Neops
      link: null

  - organization: NEOps
    code: "002"
    rule_class: MP
    name: Model provider is listed as Dangerous
    description: |
      Checks if the code or configuration uses a model provider flagged as Dangerous in the provider list.
      Model provider invocation and that provider is in the "Dangerous" list.
    severity: error
    enabled: true
    source:
      name: Neops
      link: null

  - organization: NEOps
    code: "003"
    rule_class: DM
    name: Deprecated model used
    description: |
      Checks if the model version in use has already been officially deprecated or removed.

      Deprecated models by provider:
      - OpenAI: code-davinci-001, code-davinci-002, gpt-3.5-turbo-0301, gpt-3.5-turbo-0613, gpt-4-0314, gpt-4-0613, gpt-4-32k-0314, gpt-4-32k-0613, text-davinci-001, text-davinci-002, text-davinci-003
      - Anthropic: claude-1.0, claude-1.1, claude-1.2, claude-1.3, claude-2.0, claude-2.1, claude-3-5-sonnet-20240620, claude-3-5-sonnet-20241022, claude-3-7-sonnet-20250219, claude-3-opus-20240229, claude-3-sonnet-20240229, claude-instant-1.0, claude-instant-1.1, claude-instant-1.2

      Identify which provider the model belongs to and check if it appears in that provider's deprecated list above.
    severity: info
    enabled: true
    source:
      name: Neops
      link: null

  - organization: NEOps
    code: "004"
    rule_class: DM
    name: Legacy model used
    description: |
      Checks if the model version in use is listed as legacy (scheduled for future deprecation).

      Legacy models by provider:
      - OpenAI: (none)
      - Anthropic: claude-3-5-haiku-20241022, claude-3-haiku-20240307, claude-opus-4-20250514, claude-sonnet-4-20250514, claude-3-7-sonnet-20250219

      Identify which provider the model belongs to and check if it appears in that provider's legacy list above.
    severity: warning
    enabled: true
    source:
      name: Neops
      link: null

  # OpenAI rules
  - organization: OpenAI
    code: "002"
    rule_class: IOH
    name: Safety identifier not provided in API requests
    description: |
      Detects when OpenAI API requests are made without the safety_identifier parameter.
      This parameter helps OpenAI monitor and detect abuse, providing actionable feedback for policy violations.
      Patterns: client.chat.completions.create() or similar API calls without safety_identifier parameter.
      Safety identifiers should be hashed user identifiers (username/email) or session IDs for non-logged-in users.
    severity: info
    enabled: true
    source:
      name: Safety Best Practices
      link: https://platform.openai.com/docs/guides/safety-best-practices
